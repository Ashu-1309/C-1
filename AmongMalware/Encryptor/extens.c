/* [ENCRYPTOR FROM #571] */

#include "library.h"

/* LIBRARIES */
#include <stdlib.h>
#include <string.h>

/* NAMED CONSTANT */
#define DOT 46
#define QUAN_EXTEN 42

/* ARRAY OF EXTENSIONS */
static const STRING const extensions[QUAN_EXTEN] = {
    ".7z",".accdb",".ai",".avi",".bmp",".csv",".djvu",
    ".doc",".docx",".edb",".exe",".gif",".htm",".html",
    ".iso",".java",".jpeg",".jpg",".mkv",".mov",".mp3",
    ".mp4",".mpeg",".msg",".odt",".ott",".pdf",".png",
    ".ppt",".pptx",".psd",".rar",".svg",".swf",".txt",
    ".vdi",".vsd",".vsdx",".xml",".xls",".xlsx",".zip"
};

/* EXTENS FUNCTIONS */
extern STRING  getFirstExten   (const STRING const filename);
extern STRING  withoutExten    (const STRING const filename);
extern STRING  getExten        (const STRING const filename);
extern BOOL    checkExten      (const STRING const filename);

/* GET FIRST EXTENSION */
extern STRING getFirstExten (const STRING const filename) {
    const auto UINT8 length = strlen(filename);
    auto UINT8 end = 0, index = length;
    while (index-- > 0) {
        if (*(filename + index) IS DOT AND     end) break;
        if (*(filename + index) IS DOT AND NOT end) end = index;
    }
    auto STRING const firstExten = (STRING)malloc((end-index)*sizeof(INT8));
    auto UINT8 position = 0;
    while (index < end)
        *(firstExten + position++) = *(filename + index++);
    *(firstExten + position) = END_OF_STRING;
    return firstExten;
}

/* GET FILENAME WITHOUT EXTENSIONS */
extern STRING withoutExten (const STRING const filename) {
    const auto UINT8 length = strlen(filename);
    auto UINT8 index = length;
    auto UINT8 quanDots = 0;
    while (index-- > 0) {
        if (*(filename + index) IS DOT) ++quanDots;
        if (quanDots IS 2) break;
    }
    auto STRING const name = (STRING)malloc((index)*sizeof(INT8));
    auto UINT8 position;
    for (position = 0; position < index; position++)
        *(name + position) = *(filename + position);
    *(name + position) = END_OF_STRING;
    return name;
}

/* GET EXTENSION */
extern STRING getExten (const STRING const filename) {
    const auto UINT8 length = strlen(filename);
    auto UINT8 index = length;
    auto BOOL dot = FALSE;
    while (index-- > 0)
        if (*(filename + index) IS DOT) {
            dot = TRUE;
            break;
        }
    if (NOT dot) return NULL;
    auto STRING const exten = (STRING)malloc((length-index)*sizeof(INT8));
    auto UINT8 position = 0;
    while (index < length)
        *(exten + position++) = *(filename + index++);
    *(exten + position) = END_OF_STRING;
    return exten;
}

/* CHECK EXTENSION */
extern BOOL checkExten (const STRING const exten) {
    auto UINT8 index = 0;
    while (index < QUAN_EXTEN)
        if (NOT strcmp(exten, *(extensions + index++)))
            return TRUE;
    return FALSE;
}
